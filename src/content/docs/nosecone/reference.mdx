---
title: "Arcjet Nosecone reference"
description: "Reference for the Nosecone library"
---

import WhatAreArcjetUtilities from "@/components/WhatAreArcjetUtilities.astro";
import DisplayType from "@/components/DisplayType.astro";

The Arcjet Nosecone library provides a streamlined way to apply secure headers
to your application.

<WhatAreArcjetUtilities />

## API

### `nosecone(options?: NoseconeOptions): Headers`

The default export is a function that returns a set of `Headers` to apply to a
request that help you secure your application. The defaults should work for many
applications, but all can be configured or disabled for specific requirements.

### `NoseconeOptions`

All entries in `NoseconeOptions` can be enabled with defaults by specifying
`true` or disabled by specifying `false`. Additionally, many allow individual
configuration via their own configuration objects, which override any defaults.

You can use object spread, e.g. `...defaults`, to combine the default values
with your overrides.

```ts
interface NoseconeOptions {
  /**
   * Configure the `Content-Security-Policy` header, which helps mitigate a
   * large number of attacks, such as cross-site scripting.
   */
  contentSecurityPolicy?: ContentSecurityPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Embedder-Policy` header, which helps control
   * what resources can be loaded cross-origin.
   */
  crossOriginEmbedderPolicy?: CrossOriginEmbedderPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Opener-Policy` header, which helps
   * process-isolate your page.
   */
  crossOriginOpenerPolicy?: CrossOriginOpenerPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Resource-Policy` header, which blocks others
   * from loading your resources cross-origin in some cases.
   */
  crossOriginResourcePolicy?: CrossOriginResourcePolicyConfig | boolean;
  /**
   * Configure the `Origin-Agent-Cluster` header, which provides a mechanism to
   * allow web applications to isolate their origins from other processes.
   */
  originAgentCluster?: boolean;
  /**
   * Configure the `Referrer-Policy` header, which controls what information is
   * set in the `Referer` request header.
   */
  referrerPolicy?: ReferrerPolicyConfig | boolean;
  /**
   * Configure the `Strict-Transport-Security` header, which tells browsers to
   * prefer HTTPS instead of insecure HTTP.
   */
  strictTransportSecurity?: StrictTransportSecurityConfig | boolean;
  /**
   * Configure the `X-Content-Type-Options` header, which helps mitigate MIME
   * type sniffing that can cause security issues.
   */
  xContentTypeOptions?: boolean;
  /**
   * Configure the `X-DNS-Prefetch-Control` header, which helps control DNS
   * prefetching to improve user privacy at the expense of performance.
   */
  xDnsPrefetchControl?: DnsPrefetchControlConfig | boolean;
  /**
   * Configure the `X-Download-Options` header, which prevents a user from
   * opening a file directly in Internet Explorer 8 to avoid prevent script
   * injection.
   */
  xDownloadOptions?: boolean;
  /**
   * Configure the `X-Frame-Options` header, which helps mitigate clickjacking
   * attacks in legacy browsers. This header is superceded by a directive in the
   * `Content-Security-Policy` header.
   */
  xFrameOptions?: FrameOptionsConfig | boolean;
  /**
   * Configure the `X-Permitted-Cross-Domain-Policies` header, which tells some
   * clients, like Adobe products, your domain's policy for loading cross-domain
   * content.
   */
  xPermittedCrossDomainPolicies?: PermittedCrossDomainPoliciesConfig | boolean;
  /**
   * Disable the `X-XSS-Protection` header, which could introduce a browser
   * side-channel if enabled.
   */
  xXssProtection?: boolean;
}
```

### `withVercelToolbar(options: NoseconeOptions): NoseconeOptions`

Nosecone provides the `withVercelToolbar` utility function to augment Nosecone
options so the [Vercel
Toolbar](https://vercel.com/docs/workflow-collaboration/vercel-toolbar) is
allowed by the various headers.

This follows the guidelines documented by Vercel under [Using a Content Security
Policy](https://vercel.com/docs/workflow-collaboration/vercel-toolbar/managing-toolbar#using-a-content-security-policy),
but we recommend conditionally adding this based on `process.env.VERCEL_ENV`:

import WithVercelToolbar from "@/snippets/nosecone/reference/WithVercelToolbar.mdx";

<WithVercelToolbar />

## Headers

### `Content-Security-Policy`

The `Content-Security-Policy` header is a powerful allow-list of what can happen
on your page which helps mitigate many attacks, such as cross-site scripting.

**Types:**

<DisplayType type="StaticOrDynamic" generics={["S"]} from="nosecone" />
<DisplayType type="Source" from="nosecone" />
<DisplayType type="HostSource" from="nosecone" />
<DisplayType type="SchemeSource" from="nosecone" />
<DisplayType type="FrameSource" from="nosecone" />
<DisplayType type="ActionSource" from="nosecone" />
<DisplayType type="CspDirectives" from="nosecone" />
<DisplayType type="ContentSecurityPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  directives: {
    baseUri: ["'none'"],
    childSrc: ["'none'"],
    connectSrc: ["'self'"],
    defaultSrc: ["'self'"],
    fontSrc: ["'self'"],
    formAction: ["'self'"],
    frameAncestors: ["'none'"],
    frameSrc: ["'none'"],
    imgSrc: ["'self'", "blob:", "data:"],
    manifestSrc: ["'self'"],
    mediaSrc: ["'self'"],
    objectSrc: ["'none'"],
    scriptSrc: ["'self'"],
    styleSrc: ["'self'"],
    workerSrc: ["'self'"],
  },
}
```

:::note
In production environments, we recommend setting `upgradeInsecureRequests: true`
to ensure all requests are served with HTTPS.
:::

The defaults will produce the following header:

```txt
Content-Security-Policy: base-uri 'none'; child-src 'none'; connect-src 'self'; default-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; frame-src 'none'; img-src 'self' blob: data:; manifest-src 'self'; media-src 'self'; object-src 'none'; script-src 'self'; style-src 'self'; worker-src 'self';
```

Additional resources:

- [Google's CSP Evaluator](https://csp-evaluator.withgoogle.com/)
- [CSP Validator](https://cspvalidator.org/)
- [MDN's Content-Security-Policy guide](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- [OWASP Secure Headers Project - Content-Security-Policy](https://owasp.org/www-project-secure-headers/#content-security-policy)

### `Cross-Origin-Embedder-Policy`

The `Cross-Origin-Embedder-Policy` header helps control what resources can be
loaded cross-origin.

**Types:**

<DisplayType type="CrossOriginEmbedderPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "require-corp",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Embedder-Policy: require-corp
```

Additional resources:

- [MDN's Cross-Origin-Embedder-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Embedder-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Embedder-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-embedder-policy)

### `Cross-Origin-Opener-Policy`

The `Cross-Origin-Opener-Policy` header helps process-isolate your page.

**Types:**

<DisplayType type="CrossOriginOpenerPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "same-origin",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Opener-Policy: same-origin
```

Additional resources:

- [MDN's Cross-Origin-Opener-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Opener-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-opener-policy)

### `Cross-Origin-Resource-Policy`

The `Cross-Origin-Resource-Policy` header blocks others from loading your
resources cross-origin in some cases.

**Types:**

<DisplayType type="CrossOriginResourcePolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "same-origin",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Resource-Policy: same-origin
```

Additional resources:

- [Resource Policy FYI](https://resourcepolicy.fyi/)
- [MDN's Cross-Origin-Resource-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Resource-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Resource-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-resource-policy)

### `Origin-Agent-Cluster`

The `Origin-Agent-Cluster` header provides a mechanism to allow web applications
to isolate their origins from other processes.

**Types:**

```ts
type OriginAgentClusterConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
Origin-Agent-Cluster: ?1
```

Additional resources:

- [WHATPR Origin-keyed agent clusters specification](https://whatpr.org/html/6214/origin.html#origin-keyed-agent-clusters)

### `Referrer-Policy`

The `Referrer-Policy` header controls what information is set in the `Referer`
request header.

**Types:**

<DisplayType type="ReferrerPolicyConfig" from="nosecone" />
<DisplayType type="ReferrerPolicyToken" from="nosecone" />

**Defaults:**

```ts
{
  policy: ["no-referrer"],
}
```

The defaults will produce the following header:

```txt
Referrer-Policy: no-referrer
```

Additional resources:

- [Referer header: Privacy and security concerns](https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns)
- [MDN's Referrer-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy)
- [OWASP Secure Headers Project - Referrer-Policy](https://owasp.org/www-project-secure-headers/#referrer-policy)

### `Strict-Transport-Security`

The `Strict-Transport-Security` header tells browsers to prefer HTTPS instead of
insecure HTTP.

**Types:**

<DisplayType type="StrictTransportSecurityConfig" from="nosecone" />

**Defaults:**

```ts
{
  maxAge: 31536000, // 1 year
  includeSubDomains: true,
  preload: false,
}
```

The defaults will produce the following header:

```txt
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

Additional resources:

- [MDN's Strict-Transport-Security reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security)
- [OWASP Secure Headers Project - Strict-Transport-Security](https://owasp.org/www-project-secure-headers/#strict-transport-security)

### `X-Content-Type-Options`

The `X-Content-Type-Options` header helps mitigate MIME type sniffing that can
cause security issues.

**Types:**

```ts
type ContentTypeOptionsConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-Content-Type-Options: nosniff
```

Additional resources:

- [MDN's X-Content-Type-Options reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options)
- [MDN on MIME Sniffing](https://developer.mozilla.org/en-US/docs/Web/HTTP/MIME_types#mime_sniffing)
- [OWASP Secure Headers Project - X-Content-Type-Options](https://owasp.org/www-project-secure-headers/#x-content-type-options)

### `X-DNS-Prefetch-Control`

The `X-DNS-Prefetch-Control` header helps control DNS prefetching to improve
user privacy at the expense of performance.

**Types:**

<DisplayType type="DnsPrefetchControlConfig" from="nosecone" />

**Defaults:**

```ts
{
  allow: false,
}
```

The defaults will produce the following header:

```txt
X-DNS-Prefetch-Control: off
```

Additional resources:

- [MDN's X-DNS-Prefetch-Control reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control)

### `X-Download-Options` (legacy)

The **legacy** `X-Download-Options` header prevented a user from opening a file
directly in Internet Explorer to avoid prevent script injection.

**Types:**

```ts
type DownloadOptionsCofig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-Download-Options: noopen
```

Additional resources:

- [Microsoft's guide to securing IE8](https://learn.microsoft.com/en-us/archive/blogs/ie/ie8-security-part-v-comprehensive-protection#mime-handling-force-save)

### `X-Frame-Options` (legacy)

:::note
`X-Frame-Options` is superceded by the `frame-ancestors` directive in the
`Content-Security-Policy` header.
:::

The **legacy** `X-Frame-Options` header helped mitigate clickjacking attacks in
older browsers.

**Types:**

<DisplayType type="FrameOptionsConfig" from="nosecone" />

**Defaults:**

```ts
{
  action: "sameorigin",
}
```

The defaults will produce the following header:

```txt
X-Frame-Options: SAMEORIGIN
```

Additional resources:

- [MDN's X-Frame-Options reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options)
- [OWASP Secure Headers Project - X-Frame-Options](https://owasp.org/www-project-secure-headers/#x-frame-options)

### `X-Permitted-Cross-Domain-Policies`

The `X-Permitted-Cross-Domain-Policies` header tells some clients, like Adobe
products, your domain's policy for loading cross-domain content.

**Types:**

<DisplayType type="PermittedCrossDomainPoliciesConfig" from="nosecone" />

**Defaults:**

```ts
{
  permittedPolicies: "none",
}
```

The defaults will produce the following header:

```txt
X-Permitted-Cross-Domain-Policies: none
```

Additional resources:

- [OWASP Secure Headers Project - X-Permitted-Cross-Domain-Policies](https://owasp.org/www-project-secure-headers/#x-permitted-cross-domain-policies)

### `X-XSS-Protection` (legacy)

The **legacy** `X-XSS-Protection` header tried to mitigate XSS attacks, but
accidentally enabled side-channel attacks in older browsers, so Nosecone
disables it.

**Types:**

```ts
type XssProtectionConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-XSS-Protection: 0
```

Additional resources:

- [Helmet team discussing X-XSS-Protection defaults](https://github.com/helmetjs/helmet/issues/230)
- [MDN's X-XSS-Protection reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection)
- [OWASP Secure Headers Project - X-XSS-Protection](https://owasp.org/www-project-secure-headers/#x-xss-protection)
- [Portswigger explanation of side-channel](https://portswigger.net/daily-swig/new-xs-leak-techniques-reveal-fresh-ways-to-expose-user-information)

## Adapters

We provide adapters for frameworks that need additional APIs or different
defaults to integrate Nosecone smoothly.

### `@nosecone/next`

The `@nosecone/next` adapter provides defaults to ensure Next.js applications
work in production & development environments and the
`createMiddleware(options?: NoseconeOptions)` API to create a Next.js
middleware.

import Middleware from "@/snippets/nosecone/reference/next-js/Middleware.mdx";

<Middleware />

If the `Content-Security-Policy` header is specified via middleware, Next.js
will look for a `script-src` that starts with `nonce-` and apply it for each
`<script>` generated by the framework. This requires that opting-out of static
generation, which requires modifying your `Layout`:

import StaticOptOut from "@/snippets/nosecone/reference/next-js/StaticOptOut.mdx";

<StaticOptOut />

Additional resources:

- [Next.js Content-Security-Policy guide](https://nextjs.org/docs/app/building-your-application/configuring/content-security-policy)
