---
title: "Arcjet Nosecone reference"
description: "Reference for the Nosecone library showing how to configure security headers (CSP, HSTS, and others) in your Bun, Deno, Next.js, Node.js, or SvelteKit app."
---

import SDKVersionNosecone from "@/components/SDKVersionNosecone.astro";
import SDKVersionNoseconeNext from "@/components/SDKVersionNoseconeNext.astro";
import SDKVersionNoseconeSvelteKit from "@/components/SDKVersionNoseconeSvelteKit.astro";
import WhatAreArcjetUtilities from "@/components/WhatAreArcjetUtilities.astro";
import SelectableContent from "@/components/SelectableContent";
import DisplayType from "@/components/DisplayType.astro";

[<SDKVersionNosecone/>](https://www.npmjs.com/package/nosecone)

Arcjet Nosecone is an [open source library](https://github.com/arcjet/arcjet-js)
that helps set security headers such as `Content-Security-Policy` (CSP),
`Strict-Transport-Security` (HSTS), and `X-Content-Type-Options` in JS
applications built with Bun, Deno, Next.js, Node.js, or SvelteKit.

<WhatAreArcjetUtilities />

## Quick start

To get started, follow our [quick start guide](/nosecone/quick-start).

## Next.js security headers middleware

[<SDKVersionNoseconeNext/>](https://www.npmjs.com/package/@nosecone/next)

Next.js security headers can be set using the `@nosecone/next` adapter.

{/* prettier-ignore */}
<SelectableContent client:load syncKey="packageManager">
<div slot="npm" slotIdx="1">

```sh
npm i @nosecone/next
```

</div>
<div slot="pnpm" slotIdx="2">

```sh
pnpm add @nosecone/next
```

</div>
<div slot="yarn" slotIdx="3">

```sh
yarn add @nosecone/next
```

</div>
</SelectableContent>

This provides defaults to ensure Next.js applications work in production &
development environments and the `createMiddleware(options?: NoseconeOptions)`
API to create a Next.js middleware that runs on every request.

import Middleware from "@/snippets/nosecone/reference/next-js/Middleware.mdx";

<Middleware />

If the `Content-Security-Policy` header is specified via middleware, Next.js
will look for a `script-src` that starts with `nonce-` and apply it for each
`<script>` generated by the framework. This requires that opting-out of static
generation, which requires modifying your `Layout`:

import StaticOptOut from "@/snippets/nosecone/reference/next-js/StaticOptOut.mdx";

<StaticOptOut />

### Example configurations

#### Plausible Analytics + YouTube embed

This configuration applies the default Nosecone headers, but allows scripts from
and connections to Plausible Analytics and YouTube embeds from the YouTube No
Cookie domain ([privacy enhanced
mode](https://support.google.com/youtube/answer/171780)).

It also sets the upgrade insecure requests directive to `true` in production to
ensure all requests are served with HTTPS.

This configuration also enables the special handler for the Vercel Toolbar when
deployed to Vercel preview environments.

```ts title="middleware.ts"
import * as nosecone from "@nosecone/next";

const noseconeConfig: nosecone.NoseconeOptions = {
  ...nosecone.defaults,
  contentSecurityPolicy: {
    ...nosecone.defaults.contentSecurityPolicy,
    directives: {
      ...nosecone.defaults.contentSecurityPolicy.directives,
      scriptSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.scriptSrc,
        "https://plausible.io", // Analytics
      ],
      connectSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.connectSrc,
        "https://plausible.io", // Analytics
      ],
      // Set some URLs as `frameSrc` so don't include the default of `'none'`
      frameSrc: ["https://www.youtube-nocookie.com"],
      // We only set this in production because the server may be started
      // without HTTPS
      upgradeInsecureRequests: process.env.NODE_ENV === "production",
    },
  },
  crossOriginEmbedderPolicy: {
    // YouTube embeds are not served with the correct headers to support being
    // loaded with any COEP other than `unsafe-none`.
    // See:
    // * https://issuetracker.google.com/issues/240387105
    // * https://issuetracker.google.com/issues/351843802
    policy: "unsafe-none",
  },
} as const;

const noseconeMiddleware = nosecone.createMiddleware(
  process.env.VERCEL_ENV === "preview"
    ? nosecone.withVercelToolbar(noseconeConfig)
    : noseconeConfig,
);

export default noseconeMiddleware;
```

#### Clerk authentication

This configuration applies the default Nosecone headers, but allows scripts from
and connections to [Clerk](https://clerk.com) for authentication.

```ts title="middleware.ts"
import * as nosecone from "@nosecone/next";

const noseconeConfig: nosecone.NoseconeOptions = {
  ...nosecone.defaults,
  contentSecurityPolicy: {
    ...nosecone.defaults.contentSecurityPolicy,
    directives: {
      ...nosecone.defaults.contentSecurityPolicy.directives,
      scriptSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.scriptSrc,
        "https://*.clerk.accounts.dev",
      ],
      connectSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.connectSrc,
        "https://*.clerk.accounts.dev",
        "https://clerk-telemetry.com",
      ],
      workerSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.workerSrc,
        "blob:",
        "https://*.clerk.accounts.dev",
      ],
      imgSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.imgSrc,
        "https://img.clerk.com",
      ],
      objectSrc: [
        ...nosecone.defaults.contentSecurityPolicy.directives.objectSrc,
      ],
      // We only set this in production because the server may be started
      // without HTTPS
      upgradeInsecureRequests: process.env.NODE_ENV === "production",
    },
  },
} as const;

export default nosecone.createMiddleware(noseconeConfig);
```

### Chaining middleware

If you are using multiple Next.js middleware functions, you can chain them
together to add the security headers.

#### Auth.js example

This example shows how to chain Arcjet with [Auth.js](https://authjs.dev)
middleware:

import ChainedMiddleware from "@/snippets/nosecone/reference/next-js/ChainedMiddleware.mdx";

<ChainedMiddleware />

#### Multiple middleware functions

If you have multiple middleware functions you will need to chain them together.
We have written a small utility to help run different middleware for different
paths.

In [this example
code](https://github.com/arcjet/arcjet-js/blob/121dc679c91dc6f9a6486fcad3f20013830332aa/examples/nosecone-nextjs-router/middleware.ts),
the Nosecone middleware is run on every route path. You can add other middleware
into the array and add more paths to run different middleware.

### Additional resources

- [Next.js Content-Security-Policy guide](https://nextjs.org/docs/app/building-your-application/configuring/content-security-policy)
- [Next Forge SaaS template security headers example](https://docs.next-forge.com/features/security/headers)
- [Arcjet example app with Plausible analytics](https://github.com/arcjet/example-nextjs/blob/main/middleware.ts)

## SvelteKit security headers configuration

[<SDKVersionNoseconeSvelteKit/>](https://www.npmjs.com/package/@nosecone/sveltekit)

The `@nosecone/sveltekit` adapter provides defaults to ensure SvelteKit is
configured correctly.

{/* prettier-ignore */}
<SelectableContent client:load syncKey="packageManager" frameworkSwitcher>
<div slot="npm" slotIdx="1">

```sh
npm i @nosecone/sveltekit
```

</div>
<div slot="pnpm" slotIdx="2">

```sh
pnpm add @nosecone/sveltekit
```

</div>
<div slot="yarn" slotIdx="3">

```sh
yarn add @nosecone/sveltekit
```

</div>
</SelectableContent>

This also provides the `csp(options?: ContentSecurityPolicyConfig)` function
to translate Nosecone configuration to SvelteKit configuration in
`svelte.config.js`, and the `createHook(options?: NoseconeOptions)` function to
create a SvelteKit hook that runs on every request.

import SvelteKitConfig from "@/snippets/nosecone/reference/sveltekit/Config.mdx";

<SvelteKitConfig />

import SvelteKitHooks from "@/snippets/nosecone/reference/sveltekit/Hooks.mdx";

<SvelteKitHooks />

Additional resources:

- [SvelteKit CSP configuration](https://svelte.dev/docs/kit/configuration#csp)
- [Arcjet Sveltekit Nosecone hook example](https://github.com/arcjet/arcjet-js/blob/02e4435a86b6b40b97feb369f0402b2199a4bc12/examples/sveltekit/src/hooks.server.ts#L7)

## API

### `nosecone(options?: NoseconeOptions): Headers`

The default export is a function that returns a set of `Headers` to apply to a
request that help you secure your application. The defaults should work for many
applications, but all can be configured or disabled for specific requirements.

### `NoseconeOptions`

All entries in `NoseconeOptions` can be enabled with defaults by specifying
`true` or disabled by specifying `false`. Additionally, many allow individual
configuration via their own configuration objects, which override any defaults.

You can use object spread, e.g. `...defaults`, to combine the default values
with your overrides.

```ts
interface NoseconeOptions {
  /**
   * Configure the `Content-Security-Policy` header, which helps mitigate a
   * large number of attacks, such as cross-site scripting.
   */
  contentSecurityPolicy?: ContentSecurityPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Embedder-Policy` header, which helps control
   * what resources can be loaded cross-origin.
   */
  crossOriginEmbedderPolicy?: CrossOriginEmbedderPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Opener-Policy` header, which helps
   * process-isolate your page.
   */
  crossOriginOpenerPolicy?: CrossOriginOpenerPolicyConfig | boolean;
  /**
   * Configure the `Cross-Origin-Resource-Policy` header, which blocks others
   * from loading your resources cross-origin in some cases.
   */
  crossOriginResourcePolicy?: CrossOriginResourcePolicyConfig | boolean;
  /**
   * Configure the `Origin-Agent-Cluster` header, which provides a mechanism to
   * allow web applications to isolate their origins from other processes.
   */
  originAgentCluster?: boolean;
  /**
   * Configure the `Referrer-Policy` header, which controls what information is
   * set in the `Referer` request header.
   */
  referrerPolicy?: ReferrerPolicyConfig | boolean;
  /**
   * Configure the `Strict-Transport-Security` header, which tells browsers to
   * prefer HTTPS instead of insecure HTTP.
   */
  strictTransportSecurity?: StrictTransportSecurityConfig | boolean;
  /**
   * Configure the `X-Content-Type-Options` header, which helps mitigate MIME
   * type sniffing that can cause security issues.
   */
  xContentTypeOptions?: boolean;
  /**
   * Configure the `X-DNS-Prefetch-Control` header, which helps control DNS
   * prefetching to improve user privacy at the expense of performance.
   */
  xDnsPrefetchControl?: DnsPrefetchControlConfig | boolean;
  /**
   * Configure the `X-Download-Options` header, which prevents a user from
   * opening a file directly in Internet Explorer 8 to avoid prevent script
   * injection.
   */
  xDownloadOptions?: boolean;
  /**
   * Configure the `X-Frame-Options` header, which helps mitigate clickjacking
   * attacks in legacy browsers. This header is superceded by a directive in the
   * `Content-Security-Policy` header.
   */
  xFrameOptions?: FrameOptionsConfig | boolean;
  /**
   * Configure the `X-Permitted-Cross-Domain-Policies` header, which tells some
   * clients, like Adobe products, your domain's policy for loading cross-domain
   * content.
   */
  xPermittedCrossDomainPolicies?: PermittedCrossDomainPoliciesConfig | boolean;
  /**
   * Disable the `X-XSS-Protection` header, which could introduce a browser
   * side-channel if enabled.
   */
  xXssProtection?: boolean;
}
```

### `withVercelToolbar(options: NoseconeOptions): NoseconeOptions`

Nosecone provides the `withVercelToolbar` utility function to augment Nosecone
options so the [Vercel
Toolbar](https://vercel.com/docs/workflow-collaboration/vercel-toolbar) is
allowed by the various headers.

This follows the guidelines documented by Vercel under [Using a Content Security
Policy](https://vercel.com/docs/workflow-collaboration/vercel-toolbar/managing-toolbar#using-a-content-security-policy),
but we recommend conditionally adding this based on `process.env.VERCEL_ENV`:

import WithVercelToolbar from "@/snippets/nosecone/reference/WithVercelToolbar.mdx";

<WithVercelToolbar />

## Headers

### `Content-Security-Policy`

The `Content-Security-Policy` header is a powerful allow-list of what can happen
on your page which helps mitigate many attacks, such as cross-site scripting.

**Types:**

<DisplayType type="StaticOrDynamic" generics={["S"]} from="nosecone" />
<DisplayType type="Source" from="nosecone" />
<DisplayType type="HostSource" from="nosecone" />
<DisplayType type="SchemeSource" from="nosecone" />
<DisplayType type="FrameSource" from="nosecone" />
<DisplayType type="ActionSource" from="nosecone" />
<DisplayType type="CspDirectives" from="nosecone" />
<DisplayType type="ContentSecurityPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  directives: {
    baseUri: ["'none'"],
    childSrc: ["'none'"],
    connectSrc: ["'self'"],
    defaultSrc: ["'self'"],
    fontSrc: ["'self'"],
    formAction: ["'self'"],
    frameAncestors: ["'none'"],
    frameSrc: ["'none'"],
    imgSrc: ["'self'", "blob:", "data:"],
    manifestSrc: ["'self'"],
    mediaSrc: ["'self'"],
    objectSrc: ["'none'"],
    scriptSrc: ["'self'"],
    styleSrc: ["'self'"],
    workerSrc: ["'self'"],
  },
}
```

:::note
In production environments, we recommend setting `upgradeInsecureRequests: true`
to ensure all requests are served with HTTPS.
:::

The defaults will produce the following header:

```txt
Content-Security-Policy: base-uri 'none'; child-src 'none'; connect-src 'self'; default-src 'self'; font-src 'self'; form-action 'self'; frame-ancestors 'none'; frame-src 'none'; img-src 'self' blob: data:; manifest-src 'self'; media-src 'self'; object-src 'none'; script-src 'self'; style-src 'self'; worker-src 'self';
```

Additional resources:

- [Google's CSP Evaluator](https://csp-evaluator.withgoogle.com/)
- [CSP Validator](https://cspvalidator.org/)
- [Strict Content-Security-Policy article on web.dev](https://web.dev/articles/strict-csp)
- [MDN's Content-Security-Policy guide](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP)
- [OWASP Secure Headers Project - Content-Security-Policy](https://owasp.org/www-project-secure-headers/#content-security-policy)

### `Cross-Origin-Embedder-Policy`

The `Cross-Origin-Embedder-Policy` header helps control what resources can be
loaded cross-origin.

**Types:**

<DisplayType type="CrossOriginEmbedderPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "require-corp",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Embedder-Policy: require-corp
```

Additional resources:

- [MDN's Cross-Origin-Embedder-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Embedder-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Embedder-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-embedder-policy)

### `Cross-Origin-Opener-Policy`

The `Cross-Origin-Opener-Policy` header helps process-isolate your page.

**Types:**

<DisplayType type="CrossOriginOpenerPolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "same-origin",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Opener-Policy: same-origin
```

Additional resources:

- [MDN's Cross-Origin-Opener-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Opener-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-opener-policy)

### `Cross-Origin-Resource-Policy`

The `Cross-Origin-Resource-Policy` header blocks others from loading your
resources cross-origin in some cases.

**Types:**

<DisplayType type="CrossOriginResourcePolicyConfig" from="nosecone" />

**Defaults:**

```ts
{
  policy: "same-origin",
}
```

The defaults will produce the following header:

```txt
Cross-Origin-Resource-Policy: same-origin
```

Additional resources:

- [Resource Policy FYI](https://resourcepolicy.fyi/)
- [MDN's Cross-Origin-Resource-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cross-Origin-Resource-Policy)
- [OWASP Secure Headers Project - Cross-Origin-Resource-Policy](https://owasp.org/www-project-secure-headers/#cross-origin-resource-policy)

### `Origin-Agent-Cluster`

The `Origin-Agent-Cluster` header provides a mechanism to allow web applications
to isolate their origins from other processes.

**Types:**

```ts
type OriginAgentClusterConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
Origin-Agent-Cluster: ?1
```

Additional resources:

- [WHATPR Origin-keyed agent clusters specification](https://whatpr.org/html/6214/origin.html#origin-keyed-agent-clusters)

### `Referrer-Policy`

The `Referrer-Policy` header controls what information is set in the `Referer`
request header.

**Types:**

<DisplayType type="ReferrerPolicyConfig" from="nosecone" />
<DisplayType type="ReferrerPolicyToken" from="nosecone" />

**Defaults:**

```ts
{
  policy: ["no-referrer"],
}
```

The defaults will produce the following header:

```txt
Referrer-Policy: no-referrer
```

Additional resources:

- [Referer header: Privacy and security concerns](https://developer.mozilla.org/en-US/docs/Web/Security/Referer_header:_privacy_and_security_concerns)
- [MDN's Referrer-Policy reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy)
- [OWASP Secure Headers Project - Referrer-Policy](https://owasp.org/www-project-secure-headers/#referrer-policy)

### `Strict-Transport-Security`

The `Strict-Transport-Security` header tells browsers to prefer HTTPS instead of
insecure HTTP.

**Types:**

<DisplayType type="StrictTransportSecurityConfig" from="nosecone" />

**Defaults:**

```ts
{
  maxAge: 31536000, // 1 year
  includeSubDomains: true,
  preload: false,
}
```

The defaults will produce the following header:

```txt
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

Additional resources:

- [MDN's Strict-Transport-Security reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security)
- [OWASP Secure Headers Project - Strict-Transport-Security](https://owasp.org/www-project-secure-headers/#strict-transport-security)

### `X-Content-Type-Options`

The `X-Content-Type-Options` header helps mitigate MIME type sniffing that can
cause security issues.

**Types:**

```ts
type ContentTypeOptionsConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-Content-Type-Options: nosniff
```

Additional resources:

- [MDN's X-Content-Type-Options reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options)
- [MDN on MIME Sniffing](https://developer.mozilla.org/en-US/docs/Web/HTTP/MIME_types#mime_sniffing)
- [OWASP Secure Headers Project - X-Content-Type-Options](https://owasp.org/www-project-secure-headers/#x-content-type-options)

### `X-DNS-Prefetch-Control`

The `X-DNS-Prefetch-Control` header helps control DNS prefetching to improve
user privacy at the expense of performance.

**Types:**

<DisplayType type="DnsPrefetchControlConfig" from="nosecone" />

**Defaults:**

```ts
{
  allow: false,
}
```

The defaults will produce the following header:

```txt
X-DNS-Prefetch-Control: off
```

Additional resources:

- [MDN's X-DNS-Prefetch-Control reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control)

### `X-Download-Options` (legacy)

The **legacy** `X-Download-Options` header prevented a user from opening a file
directly in Internet Explorer to avoid prevent script injection.

**Types:**

```ts
type DownloadOptionsCofig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-Download-Options: noopen
```

Additional resources:

- [Microsoft's guide to securing IE8](https://learn.microsoft.com/en-us/archive/blogs/ie/ie8-security-part-v-comprehensive-protection#mime-handling-force-save)

### `X-Frame-Options` (legacy)

:::note
`X-Frame-Options` is superceded by the `frame-ancestors` directive in the
`Content-Security-Policy` header.
:::

The **legacy** `X-Frame-Options` header helped mitigate clickjacking attacks in
older browsers.

**Types:**

<DisplayType type="FrameOptionsConfig" from="nosecone" />

**Defaults:**

```ts
{
  action: "sameorigin",
}
```

The defaults will produce the following header:

```txt
X-Frame-Options: SAMEORIGIN
```

Additional resources:

- [MDN's X-Frame-Options reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options)
- [OWASP Secure Headers Project - X-Frame-Options](https://owasp.org/www-project-secure-headers/#x-frame-options)

### `X-Permitted-Cross-Domain-Policies`

The `X-Permitted-Cross-Domain-Policies` header tells some clients, like Adobe
products, your domain's policy for loading cross-domain content.

**Types:**

<DisplayType type="PermittedCrossDomainPoliciesConfig" from="nosecone" />

**Defaults:**

```ts
{
  permittedPolicies: "none",
}
```

The defaults will produce the following header:

```txt
X-Permitted-Cross-Domain-Policies: none
```

Additional resources:

- [OWASP Secure Headers Project - X-Permitted-Cross-Domain-Policies](https://owasp.org/www-project-secure-headers/#x-permitted-cross-domain-policies)

### `X-XSS-Protection` (legacy)

The **legacy** `X-XSS-Protection` header tried to mitigate XSS attacks, but
accidentally enabled side-channel attacks in older browsers, so Nosecone
disables it.

**Types:**

```ts
type XssProtectionConfig = boolean;
```

**Defaults:**

```ts
true;
```

The defaults will produce the following header:

```txt
X-XSS-Protection: 0
```

Additional resources:

- [Helmet team discussing X-XSS-Protection defaults](https://github.com/helmetjs/helmet/issues/230)
- [MDN's X-XSS-Protection reference](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection)
- [OWASP Secure Headers Project - X-XSS-Protection](https://owasp.org/www-project-secure-headers/#x-xss-protection)
- [Portswigger explanation of side-channel](https://portswigger.net/daily-swig/new-xs-leak-techniques-reveal-fresh-ways-to-expose-user-information)
