---
title: "Filters reference"
description: "Reference guide for filtering requests with Arcjet in your Next.js, Node.js, Bun, Remix, or SvelteKit app."
ajToc:
  - text: "Plan availability"
    anchor: "plan-availability"
  - text: "Configuration"
    anchor: "configuration"
  - text: "Expression language"
    anchor: "expression-language"
    children:
      - text: "Fields"
        anchor: "fields"
      - text: "Operators"
        anchor: "operators"
      - text: "Functions"
        anchor: "functions"
      - text: "Values"
        anchor: "values"
  - text: "Decision"
    anchor: "decision"
  - text: "Error handling"
    anchor: "error-handling"
  - text: "Testing"
    anchor: "testing"
---

import DisplayType from "@/components/DisplayType.astro";

Arcjet filters let you permit or block requests using
[Wireshark](https://www.wireshark.org/)-like expressions over HTTP headers, IP
addresses, and other request attributes - so you can quickly enforce rules like
allow/deny by country, network, or user-agent pattern.

## Plan availability

Arcjet filter rules is available on all [pricing
plans](https://arcjet.com/pricing).

## Configuration

Allow or deny filters are configured using one or more expressions:

- `allow` - A list of expressions that will result in an `ALLOW` decision if the
  request matches.
- `deny` - A list of expressions that will result in a `DENY` decision if the
  request matches.
- These lists are mutually-exclusive, so you can only use one or the other.

They are constructed with the `filters(options)` function and configured by
`FilterOptionsAllow` or `FilterOptionsDeny`:

<DisplayType from="arcjet" type="FilterOptions" />
<DisplayType from="arcjet" type="ArcjetMode" />

:::note
When specifying multiple rules, the order of the rules is ignored. Rule
execution ordering is automatically optimized for performance.
See [decision](#decision) below for details of examining the execution results.
:::

## Expression language

The expression language is based on [Wireshark](https://www.wireshark.org/)-like
display filters. Like other programming languages, there are fields
(`ip.src.vpn`), functions (`lower()`), operators (`or`, `matches`), and values
(`"curl"`).

### Example: Matching VPN, Tor, or Curl requests

This example matches VPN or Tor traffic and basic Curl requests.

```text
ip.src.vpn or
  ip.src.tor or
  lower(http.request.headers["user-agent"]) matches "curl"
```

### Example: Matching requests from specific countries

This example matches requests from the European Union:

```text
ip.src.country in {"AT" "BE" "BG" "CY" "CZ" "DE" "DK" "EE" "ES" "FI" "FR" "GR" "HR" "HU" "IE" "IT" "LT" "LU" "LV" "MT" "NL" "PL" "PT" "RO" "SE" "SI" "SK"}
```

## Fields

| Field                    | Type          | Example value                                 |
| ------------------------ | ------------- | --------------------------------------------- |
| `http.host`              | `string`      | `"example.com"`                               |
| `http.request.cookie`    | `Map<string>` | `{NEXT_LOCALE: "en-US", …}`                   |
| `http.request.headers`   | `Map<string>` | `{"user-agent": "Mozilla/5.0 (Macintosh; …"}` |
| `http.request.method`    | `string`      | `"GET"`                                       |
| `http.request.uri.args`  | `Map<string>` | `{q: "search"}`                               |
| `http.request.uri.path`  | `string`      | `"/quick-start"`                              |
| `ip.src.accuracy_radius` | `string`      | `"2"`                                         |
| `ip.src.asnum.country`   | `string`      | `"US"`                                        |
| `ip.src.asnum.domain`    | `string`      | `"fastly.com"`                                |
| `ip.src.asnum.name`      | `string`      | `"Fastly, Inc."`                              |
| `ip.src.asnum.type`      | `string`      | `"business"`                                  |
| `ip.src.asnum`           | `string`      | `"54113"`                                     |
| `ip.src.city`            | `string`      | `"Uniontown"`                                 |
| `ip.src.continent.name`  | `string`      | `"North America"`                             |
| `ip.src.continent`       | `string`      | `"NA"`                                        |
| `ip.src.country.name`    | `string`      | `"United States"`                             |
| `ip.src.country`         | `string`      | `"US"`                                        |
| `ip.src.crawler.name`    | `string`      | `""`                                          |
| `ip.src.crawler`         | `boolean`     | `false`                                       |
| `ip.src.hosting`         | `boolean`     | `false`                                       |
| `ip.src.lat`             | `string`      | `"39.90008"`                                  |
| `ip.src.lon`             | `string`      | `"-79.71643"`                                 |
| `ip.src.mobile`          | `boolean`     | `false`                                       |
| `ip.src.postal_code`     | `string`      | `"15472"`                                     |
| `ip.src.proxy`           | `boolean`     | `false`                                       |
| `ip.src.region`          | `string`      | `"Pennsylvania"`                              |
| `ip.src.relay`           | `boolean`     | `false`                                       |
| `ip.src.service`         | `string`      | `""`                                          |
| `ip.src.timezone.name`   | `string`      | `"America/New_York"`                          |
| `ip.src.tor`             | `boolean`     | `false`                                       |
| `ip.src.vpn`             | `boolean`     | `false`                                       |
| `ip.src`                 | `Ip`          | `185.199.108.153`                             |

All `ip.src.*` fields reflect information about the client IP address (the request source IP).

That information is gathered by our Decide API.
Other fields are available locally.

## Operators

| Operator          | Example expression                                                         |
| ----------------- | -------------------------------------------------------------------------- |
| `and` (`&&`)      | `http.request.method eq "GET" and http.request.uri.path eq "/quick-start"` |
| `contains`        | `http.request.uri.path contains "quick-start"`                             |
| `eq` (`==`)       | `http.request.method eq "GET"`                                             |
| `ge` (`>=`)       | `len(http.request.uri.args["q"]) ge 1`                                     |
| `gt` (`>`)        | `len(http.request.uri.args["q"]) gt 0`                                     |
| `in`              | `ip.src in { 185.199.108.153 185.199.109.153 }`                            |
| `le` (`<=`)       | `len(http.request.uri.args["q"]) le 3`                                     |
| `lt` (`<`)        | `len(http.request.uri.args["q"]) lt 4`                                     |
| `matches` (`~`)   | `http.request.headers["user-agent"] matches "Chrome"`                      |
| `ne` (`!=`)       | `http.request.method ne "GET"`                                             |
| `not` (`!`)       | `not ip.src.vpn`                                                           |
| `or` (`\|\|`)     | `ip.src.vpn or ip.src.relay`                                               |
| `strict wildcard` | `http.request.uri.path strict wildcard "/articles/*"`                      |
| `wildcard`        | `http.request.uri.path wildcard "/articles/*"`                             |
| `xor` (`^^`)      | `ip.src.vpn xor ip.src.relay`                                              |

## Functions

| Function | Example                                                       |
| -------- | ------------------------------------------------------------- |
| `len`    | `len(http.request.uri.args["q"]) gt 0`                        |
| `lower`  | `lower(ip.src.country) contains "be"`                         |
| `upper`  | `upper(http.request.headers["user-agent"]) contains "CHROME"` |

## Values

### Strings

String values are enclosed in double quotes (`"`).

Double quotes within the string must be escaped with a backslash (`\"`).

```text
http.host eq "example.com"
```

### Booleans

Boolean values are either `true` or `false`.
You can negate a boolean value with the `not` (`!`) operator.

```text
ip.src.vpn
```

```text
not ip.src.vpn
```

### IP addresses

IP addresses are a special type which must not be quoted like strings.

```text
ip.src eq 185.199.108.153
```

```text
ip.src in { 185.199.108.153 185.199.109.153 185.199.110.153 185.199.111.153 }
```

```text
ip.src in { 192.0.2.0/24 }
```

### Maps

Maps (or associative arrays) are a collection of keys to values.

They cannot be written literally in the expression language, but they exist for
the fields `http.request.cookie`, `http.request.headers`, and
`http.request.uri.args`.

```text
http.request.headers["user-agent"] matches "Chrome"
```

## Decision

Arcjet provides a single `protect` function that is used to execute your
protection rules.

This function returns a `Promise` that resolves to an `ArcjetDecision` object.
This contains the following properties:

- `id` (`string`) - The unique ID for the request. This can be used to look up
  the request in the Arcjet dashboard. It is prefixed with `req_` for decisions
  involving the Arcjet cloud API. For decisions taken locally, the prefix is
  `lreq_`.
- `conclusion` (`ArcjetConclusion`) - The final conclusion based on evaluating
  each of the configured rules. If you wish to accept Arcjet's recommended
  action based on the configured rules then you can use this property.
- `reason` (`ArcjetReason`) - An object containing more detailed
  information about the conclusion.
- `results` (`ArcjetRuleResult[]`) - An array of `ArcjetRuleResult` objects
  containing the results of each rule that was executed.
- `ip` (`ArcjetIpDetails`) - An object containing Arcjet's analysis of the
  client IP address. See the SDK reference for more information.

You check if a deny conclusion has been returned by a filter rule by using
`decision.isDenied()` and `decision.reason.isFilterRule()` respectively.

You can iterate through the results and check whether a filter rule was applied:

```ts
for (const result of decision.results) {
  console.log("Rule Result", result);
}
```

## Error handling

Arcjet is designed to fail open so that a service issue or misconfiguration does
not block all requests. The SDK will also time out and fail open after 500ms
when `NODE_ENV` is `production` and 1000ms otherwise. However, in most cases,
the response time will be less than 20-30ms.

If there is an error condition when processing the rule, Arcjet will return an
`ERROR` result for that rule and you can check the `message` property on the rule's
error result for more information.

If all other rules that were run returned an `ALLOW` result, then the final Arcjet
conclusion will be `ERROR`.

## Testing

Arcjet runs the same in any environment, including locally and in CI. You can
use the `mode` set to `DRY_RUN` to log the results of rule execution without
blocking any requests.

We have an example test framework you can use to automatically test your rules.
Arcjet can also be triggered based using a sample of your traffic.

See the [Testing](/testing) section of the docs for details.
